<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€ç»´ååŒå¤„ç†å™¨ - ç§»åŠ¨æŸ¥çœ‹å™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: sans-serif; padding: 20px; background: #f5f9fc; }
        .container { max-width: 600px; margin: 0 auto; }
        .header { 
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px;
            text-align: center;
        }
        .card { 
            background: white; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn { 
            background: #1a237e; 
            color: white; 
            border: none; 
            padding: 12px; 
            border-radius: 6px; 
            width: 100%; 
            margin: 10px 0; 
            cursor: pointer;
        }
        .btn:hover { background: #283593; }
        .item { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; }
        .item:hover { background: #f8f9fa; }
        .loading { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>ğŸ§  æ€ç»´ååŒå¤„ç†å™¨</h2>
            <p>ç§»åŠ¨æŸ¥çœ‹å™¨</p>
        </div>
        
        <div class="card">
            <h3>æ•°æ®çŠ¶æ€</h3>
            <p>æ€è€ƒè®°å½•: <span id="thought-count">0</span></p>
            <p>æ€ç»´æ¨¡å‹: <span id="model-count">0</span></p>
            <p>æœ€åæ›´æ–°: <span id="last-update">ä»æœª</span></p>
        </div>
        
        <div id="tabs">
            <button class="btn" onclick="showTab('thoughts')">æŸ¥çœ‹æ€è€ƒè®°å½•</button>
            <button class="btn" onclick="showTab('models')">æŸ¥çœ‹æ€ç»´æ¨¡å‹</button>
            <button class="btn" onclick="loadData()">é‡æ–°åŠ è½½æ•°æ®</button>
        </div>
        
        <div id="content" class="card">
            <div class="loading">
                <p>åŠ è½½æ•°æ®ä¸­...</p>
                <p>ä» <code>thought-processor-data.json</code> åŠ è½½</p>
            </div>
        </div>
    </div>

    <script>
        // è¶…ç®€å•çš„ç§»åŠ¨ç«¯æ•°æ®åŠ è½½å™¨
        const MobileViewer = {
            data: null,
            currentTab: 'thoughts',
            
            init: function() {
                this.loadData();
            },
            
            // æ ¸å¿ƒï¼šä» GitHub Pages åŠ è½½ JSON æ•°æ®æ–‡ä»¶
            loadData: function() {
                const contentDiv = document.getElementById('content');
                contentDiv.innerHTML = '<div class="loading">åŠ è½½æ•°æ®ä¸­...</div>';
                
                // ä»å›ºå®š URL åŠ è½½ JSON æ–‡ä»¶
                fetch('./thought-processor-data.json?v=' + Date.now())
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('æ— æ³•åŠ è½½æ•°æ®æ–‡ä»¶');
                        }
                        return response.json();
                    })
                    .then(data => {
                        this.data = data;
                        this.updateStats();
                        this.showThoughts();
                        this.saveToLocalStorage(data);
                    })
                    .catch(error => {
                        console.error('åŠ è½½å¤±è´¥:', error);
                        this.loadFromLocalStorage();
                    });
            },
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ï¼ˆç¦»çº¿æ—¶ä½¿ç”¨ï¼‰
            loadFromLocalStorage: function() {
                const saved = localStorage.getItem('thought-processor-data');
                if (saved) {
                    try {
                        this.data = JSON.parse(saved);
                        this.updateStats();
                        this.showThoughts();
                    } catch(e) {
                        this.showError('æœ¬åœ°æ•°æ®å·²æŸå');
                    }
                } else {
                    this.showError('è¯·å…ˆåœ¨ç”µè„‘ç«¯å¯¼å‡ºæ•°æ®æ–‡ä»¶ï¼Œå¹¶ä¸Šä¼ åˆ° GitHub ä»“åº“ã€‚');
                }
            },
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveToLocalStorage: function(data) {
                localStorage.setItem('thought-processor-data', JSON.stringify(data));
            },
            
            updateStats: function() {
                document.getElementById('thought-count').textContent = this.data.thoughts?.length || 0;
                document.getElementById('model-count').textContent = this.data.models?.length || 0;
                
                if (this.data.lastSaved) {
                    const date = new Date(this.data.lastSaved);
                    document.getElementById('last-update').textContent = date.toLocaleString();
                }
            },
            
            showThoughts: function() {
                this.currentTab = 'thoughts';
                const thoughts = this.data.thoughts || [];
                
                let html = '<h3>æ€è€ƒè®°å½• (' + thoughts.length + ')</h3>';
                
                if (thoughts.length === 0) {
                    html += '<p>æš‚æ— æ€è€ƒè®°å½•</p>';
                } else {
                    thoughts.forEach(thought => {
                        const preview = thought.sections?.["æ ¸å¿ƒç»“è®º"]?.substring(0, 100) || 
                                       thought.sections?.["çŠ¶æ€çœ‹æ¿"]?.substring(0, 100) || 
                                       'æš‚æ— æè¿°';
                        
                        html += `
                            <div class="item" onclick="MobileViewer.showThoughtDetail('${thought.id}')">
                                <div style="font-weight: bold;">${thought.title || thought.id}</div>
                                <div style="color: #666; font-size: 14px; margin-top: 5px;">${preview}...</div>
                            </div>
                        `;
                    });
                }
                
                document.getElementById('content').innerHTML = html;
            },
            
            showModels: function() {
                this.currentTab = 'models';
                const models = this.data.models || [];
                
                let html = '<h3>æ€ç»´æ¨¡å‹ (' + models.length + ')</h3>';
                
                if (models.length === 0) {
                    html += '<p>æš‚æ— æ€ç»´æ¨¡å‹</p>';
                } else {
                    models.forEach(model => {
                        html += `
                            <div class="item" onclick="MobileViewer.showModelDetail('${model.id}')">
                                <div style="font-weight: bold;">
                                    <span style="color: #ff9800; font-family: monospace;">${model.id}</span>: ${model.name}
                                </div>
                                <div style="color: #666; font-size: 14px; margin-top: 5px;">
                                    ${model.description.substring(0, 100)}...
                                </div>
                            </div>
                        `;
                    });
                }
                
                document.getElementById('content').innerHTML = html;
            },
            
            showThoughtDetail: function(id) {
                const thought = (this.data.thoughts || []).find(t => t.id === id);
                if (!thought) return;
                
                let html = `
                    <button onclick="MobileViewer.showThoughts()" style="background: none; border: none; color: #666; cursor: pointer; margin-bottom: 15px;">
                        â† è¿”å›
                    </button>
                    <h3>${thought.title || thought.id}</h3>
                `;
                
                // æ˜¾ç¤ºæ‰€æœ‰éƒ¨åˆ†
                if (thought.sections) {
                    for (const [section, text] of Object.entries(thought.sections)) {
                        if (text) {
                            html += `
                                <div style="margin-top: 20px;">
                                    <div style="font-weight: bold; color: #1a237e; margin-bottom: 10px;">${section}</div>
                                    <div style="white-space: pre-wrap; font-size: 14px; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                                        ${this.processLinks(text)}
                                    </div>
                                </div>
                            `;
                        }
                    }
                }
                
                document.getElementById('content').innerHTML = html;
            },
            
            showModelDetail: function(id) {
                const model = (this.data.models || []).find(m => m.id === id);
                if (!model) return;
                
                let html = `
                    <button onclick="MobileViewer.showModels()" style="background: none; border: none; color: #666; cursor: pointer; margin-bottom: 15px;">
                        â† è¿”å›
                    </button>
                    <h3><span style="color: #ff9800; font-family: monospace;">${model.id}</span>: ${model.name}</h3>
                    <div style="margin-top: 15px; white-space: pre-wrap;">${this.processLinks(model.description)}</div>
                `;
                
                if (model.fromThought) {
                    html += `
                        <div style="margin-top: 20px;">
                            <div style="font-weight: bold;">æ¥æºæ€è€ƒ:</div>
                            <span style="color: #4caf50; cursor: pointer;" onclick="MobileViewer.showThoughtDetail('${model.fromThought}')">
                                ${model.fromThought}
                            </span>
                        </div>
                    `;
                }
                
                if (model.relatedModels && model.relatedModels.length > 0) {
                    html += `
                        <div style="margin-top: 20px;">
                            <div style="font-weight: bold;">å…³è”æ¨¡å‹:</div>
                            <div style="margin-top: 10px;">
                                ${model.relatedModels.map(mid => 
                                    `<span style="display: inline-block; background: #e8edff; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;" 
                                          onclick="MobileViewer.showModelDetail('${mid}')">${mid}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                document.getElementById('content').innerHTML = html;
            },
            
            // å¤„ç†æ–‡æœ¬ä¸­çš„é“¾æ¥ï¼ˆ#123 å’Œ M-80ï¼‰
            processLinks: function(text) {
                if (!text) return '';
                
                // å¤„ç†æ€è€ƒID (#123)
                let processed = text.replace(/#(\d+)/g, (match, id) => {
                    return `<span style="color: #4caf50; cursor: pointer; text-decoration: underline;" 
                                  onclick="MobileViewer.showThoughtDetail('#${id}')">${match}</span>`;
                });
                
                // å¤„ç†æ¨¡å‹ID (M-80)
                processed = processed.replace(/M-\d+/g, (match) => {
                    return `<span style="color: #ff9800; cursor: pointer; text-decoration: underline;" 
                                  onclick="MobileViewer.showModelDetail('${match}')">${match}</span>`;
                });
                
                return processed;
            },
            
            showError: function(message) {
                document.getElementById('content').innerHTML = `
                    <div style="color: #f44336; text-align: center; padding: 20px;">
                        <h3>âš ï¸ åŠ è½½å¤±è´¥</h3>
                        <p>${message}</p>
                        <p>è¯·ç¡®ä¿ç”µè„‘ç«¯å·²å¯¼å‡ºæ•°æ®æ–‡ä»¶å¹¶ä¸Šä¼ åˆ° GitHub ä»“åº“ã€‚</p>
                        <button onclick="MobileViewer.loadData()" class="btn" style="margin-top: 20px;">
                            é‡è¯•åŠ è½½
                        </button>
                    </div>
                `;
            }
        };
        
        // å…¨å±€å‡½æ•°
        function loadData() { MobileViewer.loadData(); }
        function showTab(tab) { 
            if (tab === 'thoughts') MobileViewer.showThoughts(); 
            if (tab === 'models') MobileViewer.showModels(); 
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => MobileViewer.init());
    </script>
</body>
</html>

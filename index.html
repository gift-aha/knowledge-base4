<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ€ç»´ååŒå¤„ç†å™¨ - æ™ºèƒ½è§£æå¢å¼ºç‰ˆ</title>
    
    <!-- å…ƒæ•°æ® -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="description" content="æ€ç»´ååŒå¤„ç†å™¨ - ä¸ªäººçŸ¥è¯†ç®¡ç†ä¸æ€ç»´æ¨¡å‹æ„å»ºå·¥å…·ï¼Œå¸®åŠ©ä½ ç»“æ„åŒ–æ€è€ƒã€ç®¡ç†è®¤çŸ¥æ¨¡å‹ã€å»ºç«‹ä¸ªäººçŸ¥è¯†ä½“ç³»">
    <meta name="keywords" content="çŸ¥è¯†ç®¡ç†,æ€ç»´æ¨¡å‹,è®¤çŸ¥å·¥å…·,ä¸ªäººæˆé•¿,æ€ç»´è®­ç»ƒ">
    <meta name="author" content="Aha">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile.css">
    <!-- åœ¨åŸæœ‰CSSä¹‹åæ·»åŠ  -->
    <link rel="stylesheet" href="layout-fix.css">
    <!-- åœ¨æ‰€æœ‰CSSæ–‡ä»¶ä¹‹åæ·»åŠ  -->
    <link rel="stylesheet" href="flex-fix.css" id="flex-fix-css">
    
    <style>
        /* ä¸´æ—¶æ ·å¼ç”¨äºè°ƒè¯• */
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 9999;
            font-size: 12px;
            max-width: 300px;
            display: none;
        }
        
        .error-state {
            text-align: center;
            padding: 100px 20px;
        }
        
        .error-state h2 {
            color: #dc3545;
            margin-bottom: 20px;
        }
        
        .error-state ol {
            text-align: left;
            max-width: 400px;
            margin: 20px auto;
            padding-left: 20px;
            line-height: 1.6;
        }
        
        .error-state li {
            margin-bottom: 10px;
        }
        
        .btn-primary {
            padding: 10px 20px;
            background: #5c6bc0;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .btn-primary:hover {
            background: #3f51b5;
        }
        
        .loading-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5c6bc0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ç¡®ä¿bodyå’Œå†…å®¹å¯è§ */
        body {
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        /* å†…å®¹åŒºåŸŸé»˜è®¤éšè—ï¼Œåˆå§‹åŒ–åæ˜¾ç¤º */
        #content-area {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }
        
        /* åˆå§‹åŒ–å®Œæˆåæ˜¾ç¤ºçš„ç±» */
        .app-initialized #page-skeleton {
            display: none !important;
        }
        
        .app-initialized #content-area {
            opacity: 1 !important;
            visibility: visible !important;
            display: block !important;
        }
    </style>
</head>
<body>
    <!-- è°ƒè¯•ä¿¡æ¯ -->
    <div class="debug-info" id="debug-info"></div>
    
    <!-- é¡µé¢éª¨æ¶ï¼ˆé¿å…é¡µé¢ç©ºç™½ï¼‰ -->
    <div id="page-skeleton">
        <!-- æ¡Œé¢ç«¯é¡¶éƒ¨æ  -->
        <div class="top-bar desktop-only">
            <div class="logo">
                <div class="logo-icon">ğŸ§ </div>
                <div class="logo-text">æ€ç»´ååŒå¤„ç†å™¨</div>
            </div>
            <div class="system-info">
                <span>å½“å‰ç‰ˆæœ¬: <strong id="current-version">v22.48</strong></span>
                <span style="margin: 0 5px;">|</span>
                <span>æ¨¡å‹æ€»æ•°: <strong id="total-models">0</strong></span>
                <span style="margin: 0 5px;">|</span>
                <span>æ€è€ƒè®°å½•: <strong id="total-thoughts">0</strong></span>
                <span style="margin: 0 5px;">|</span>
                <span>æ ‡ç­¾æ•°: <strong id="total-tags">0</strong></span>
            </div>
            <div class="sync-controls">
                <button class="sync-btn" id="sync-btn" title="åŒæ­¥æ•°æ®" disabled>
                    <i class="fas fa-sync-alt"></i> åŒæ­¥
                </button>
                <button class="sync-btn" id="export-btn" title="å¯¼å‡ºæ•°æ®" disabled>
                    <i class="fas fa-download"></i> å¯¼å‡º
                </button>
                <button class="sync-btn" id="github-export-btn-top" title="å¯¼å‡ºåˆ°GitHubæ–‡ä»¶" disabled>
                    <i class="fas fa-cloud-upload-alt"></i> GitHub
                </button>
            </div>
            <div class="current-view" id="current-view">æ­£åœ¨åŠ è½½...</div>
        </div>
        
        <!-- ä¸»å®¹å™¨ -->
        <div class="main-container">
            <!-- å·¦ä¾§å¯¼èˆªæ  -->
            <div class="sidebar">
                <div class="loading-indicator">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 15px; color: #666;">åŠ è½½ä¸­...</p>
                </div>
            </div>
            
            <!-- ä¸»å†…å®¹åŒº -->
            <div class="content-area" id="content-area">
                <div class="loading-indicator">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 15px; color: #666;">æ­£åœ¨åˆå§‹åŒ–åº”ç”¨...</p>
                </div>
            </div>
            
            <!-- å³ä¾§é¢æ¿ -->
            <div class="right-panel">
                <div class="loading-indicator">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- é”™è¯¯çŠ¶æ€å®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div id="error-container" style="display: none;">
        <div class="error-state">
            <h2>ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥</h2>
            <p style="color:#666; margin:15px 0;">æ— æ³•åŠ è½½åº”ç”¨ç¨‹åºï¼Œè¯·æ£€æŸ¥ï¼š</p>
            <ol>
                <li>ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸</li>
                <li>æµè§ˆå™¨æ˜¯å¦æ”¯æŒJavaScript</li>
                <li>å°è¯•åˆ·æ–°é¡µé¢æˆ–æ¸…é™¤ç¼“å­˜</li>
                <li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯</li>
            </ol>
            <div style="margin-top:30px;">
                <button onclick="location.reload()" class="btn-primary" style="margin-right: 10px;">
                    <i class="fas fa-redo"></i> åˆ·æ–°é¡µé¢
                </button>
                <button onclick="showDebugInfo()" class="btn-primary" style="background: #6c757d;">
                    <i class="fas fa-bug"></i> æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
                </button>
            </div>
            <div id="detailed-error" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; display: none;">
                <pre id="error-details" style="text-align: left; font-size: 12px;"></pre>
            </div>
        </div>
    </div>

    <!-- è°ƒè¯•æŒ‰é’® -->
    <div style="position: fixed; bottom: 10px; right: 10px; z-index: 10000;">
        <button onclick="manualDebug()" style="padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer;">
            è°ƒè¯•
        </button>
    </div>

    <!-- JavaScript æ–‡ä»¶ -->
    <!-- ä½¿ç”¨deferå±æ€§ç¡®ä¿æŒ‰é¡ºåºæ‰§è¡Œä¸”ä¸é˜»å¡æ¸²æŸ“ -->
    <script src="script.js" defer onerror="handleScriptError('script.js')"></script>
    <script src="data-sync.js" defer onerror="handleScriptError('data-sync.js')"></script>
    <script src="mobile-config.js" defer onerror="handleScriptError('mobile-config.js')"></script>
    <script src="mobile.js" defer onerror="handleScriptError('mobile.js')"></script>
    
    <script>
        // å…¨å±€åº”ç”¨çŠ¶æ€
        const AppState = {
            initialized: false,
            scriptsLoaded: 0,
            totalScripts: 4,
            errors: []
        };
        
        // è„šæœ¬é”™è¯¯å¤„ç†
        function handleScriptError(scriptName) {
            const error = `è„šæœ¬åŠ è½½å¤±è´¥: ${scriptName}`;
            console.error(error);
            AppState.errors.push(error);
            updateLoadingProgress();
        }
        
        // æ›´æ–°åŠ è½½è¿›åº¦
        function updateLoadingProgress() {
            AppState.scriptsLoaded++;
            
            // å¦‚æœæ‰€æœ‰è„šæœ¬éƒ½å°è¯•åŠ è½½å®Œæˆï¼ˆæ— è®ºæˆåŠŸä¸å¦ï¼‰
            if (AppState.scriptsLoaded >= AppState.totalScripts) {
                // ç­‰å¾…ä¸€å°æ®µæ—¶é—´è®©è„šæœ¬æ‰§è¡Œ
                setTimeout(checkAppInitialization, 100);
            }
        }
        
        // æ£€æŸ¥Appæ˜¯å¦åˆå§‹åŒ–æˆåŠŸ
        function checkAppInitialization() {
            // å¦‚æœå·²ç»æœ‰é”™è¯¯ï¼Œç›´æ¥æ˜¾ç¤º
            if (AppState.errors.length > 0) {
                showErrorState(AppState.errors.join('\n'));
                return;
            }
            
            // æ£€æŸ¥Appå¯¹è±¡æ˜¯å¦å­˜åœ¨
            if (typeof window.App === 'undefined') {
                showErrorState('Appå¯¹è±¡æœªå®šä¹‰ã€‚å¯èƒ½çš„åŸå› ï¼š\n1. script.jsæœªæ­£ç¡®åŠ è½½\n2. script.jsä¸­æœ‰è¯­æ³•é”™è¯¯\n3. Appå¯¹è±¡åœ¨script.jsä¸­çš„åç§°ä¸ä¸€è‡´');
                return;
            }
            
            // æ£€æŸ¥App.initæ˜¯å¦å­˜åœ¨
            if (typeof window.App.init !== 'function') {
                showErrorState('App.initä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å‡½æ•°');
                return;
            }
            
            // å°è¯•åˆå§‹åŒ–
            try {
                console.log('æ­£åœ¨åˆå§‹åŒ–åº”ç”¨ç¨‹åº...');
                window.App.init();
                AppState.initialized = true;
                
                // æ³¨æ„ï¼šè¿™é‡Œä¸å†éšè—éª¨æ¶ï¼Œç”±App.init()è‡ªå·±æ§åˆ¶
                console.log('åº”ç”¨ç¨‹åºåˆå§‹åŒ–æˆåŠŸ');
                
                // ç»‘å®šGitHubæŒ‰é’®äº‹ä»¶
                bindGitHubButtons();
                
            } catch (error) {
                showErrorState(`åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:\n${error.message}\n${error.stack}`);
            }
        }
        
        // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
        function showErrorState(errorDetails) {
            // éšè—éª¨æ¶
            document.getElementById('page-skeleton').style.display = 'none';
            
            // æ˜¾ç¤ºé”™è¯¯å®¹å™¨
            const errorContainer = document.getElementById('error-container');
            errorContainer.style.display = 'block';
            
            // è®¾ç½®é”™è¯¯è¯¦æƒ…
            document.getElementById('error-details').textContent = errorDetails;
            
            // è®°å½•åˆ°æ§åˆ¶å°
            console.error('åº”ç”¨ç¨‹åºåˆå§‹åŒ–å¤±è´¥:', errorDetails);
        }
        
        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        function showDebugInfo() {
            const details = document.getElementById('detailed-error');
            const button = event.target;
            
            if (details.style.display === 'none') {
                details.style.display = 'block';
                button.innerHTML = '<i class="fas fa-eye-slash"></i> éšè—è°ƒè¯•ä¿¡æ¯';
            } else {
                details.style.display = 'none';
                button.innerHTML = '<i class="fas fa-bug"></i> æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯';
            }
        }
        
        // ç»‘å®šGitHubæŒ‰é’®äº‹ä»¶
        function bindGitHubButtons() {
            // ç»‘å®šé¡¶éƒ¨æŒ‰é’®
            const topBtn = document.getElementById('github-export-btn-top');
            if (topBtn && typeof GitHubDataSync !== 'undefined') {
                topBtn.addEventListener('click', function() {
                    GitHubDataSync.exportDataForGitHub();
                });
                topBtn.disabled = false;
            }
            
            // ç»‘å®šå³ä¾§é¢æ¿æŒ‰é’®ï¼ˆéœ€è¦å…ˆç¡®ä¿å…ƒç´ å­˜åœ¨ï¼‰
            setTimeout(function() {
                const rightBtn = document.getElementById('github-export-btn-right');
                if (rightBtn && typeof GitHubDataSync !== 'undefined') {
                    rightBtn.addEventListener('click', function() {
                        GitHubDataSync.exportDataForGitHub();
                    });
                    rightBtn.disabled = false;
                }
                
                // å¯ç”¨å…¶ä»–æŒ‰é’®
                document.getElementById('sync-btn').disabled = false;
                document.getElementById('export-btn').disabled = false;
            }, 100);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„å¤„ç†
        window.addEventListener('load', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œæ£€æŸ¥åº”ç”¨çŠ¶æ€...');
            
            // å¦‚æœè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œå¹¶ä¸”æ²¡æœ‰é”™è¯¯ï¼Œå†æ£€æŸ¥ä¸€æ¬¡
            if (!AppState.initialized && AppState.errors.length === 0) {
                setTimeout(checkAppInitialization, 500);
            }
        });
        
        // å¦‚æœ30ç§’åè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œæ˜¾ç¤ºé”™è¯¯
        setTimeout(function() {
            if (!AppState.initialized && document.getElementById('error-container').style.display === 'none') {
                showErrorState('åº”ç”¨ç¨‹åºåˆå§‹åŒ–è¶…æ—¶ã€‚å¯èƒ½çš„åŸå› ï¼š\n1. è„šæœ¬åŠ è½½æ—¶é—´è¿‡é•¿\n2. å­˜åœ¨æœªæ•è·çš„JavaScripté”™è¯¯\n3. ç½‘ç»œè¿æ¥é—®é¢˜');
            }
        }, 30000);
        
        // æ‰‹åŠ¨è§¦å‘è„šæœ¬åŠ è½½è®¡æ•°ï¼ˆå› ä¸ºdeferè„šæœ¬ä¸ä¼šè§¦å‘onloadï¼‰
        // æˆ‘ä»¬å°†ä¾èµ–setTimeoutæ¥æ£€æŸ¥
        setTimeout(function() {
            if (AppState.scriptsLoaded === 0) {
                // å‡è®¾æ‰€æœ‰è„šæœ¬éƒ½å·²å°è¯•åŠ è½½
                AppState.scriptsLoaded = AppState.totalScripts;
                checkAppInitialization();
            }
        }, 2000);

        function manualDebug() {
        console.log('=== æ‰‹åŠ¨è°ƒè¯• ===');
        console.log('1. Appå¯¹è±¡:', typeof App);
        console.log('2. DataManagerå¯¹è±¡:', typeof DataManager);
        console.log('3. AppState:', AppState);
        
        // æ£€æŸ¥DOMå…ƒç´ 
        console.log('4. é¡µé¢éª¨æ¶:', document.getElementById('page-skeleton')?.style.display);
        console.log('5. å†…å®¹åŒºåŸŸ:', document.getElementById('content-area')?.innerHTML?.substring(0, 100));
        
        // å¼ºåˆ¶æ˜¾ç¤ºå†…å®¹
        const skeleton = document.getElementById('page-skeleton');
        const content = document.getElementById('content-area');
        
        if (skeleton) {
            skeleton.style.display = 'none';
            console.log('å·²éšè—é¡µé¢éª¨æ¶');
        }
        
        if (content) {
            content.style.display = 'block';
            content.style.opacity = '1';
            content.style.visibility = 'visible';
            console.log('å·²æ˜¾ç¤ºå†…å®¹åŒºåŸŸ');
        }
        
        // å°è¯•é‡æ–°åŠ è½½è§†å›¾
        if (App && App.loadView) {
            App.loadView('overview');
            console.log('é‡æ–°åŠ è½½äº†overviewè§†å›¾');
        }
    }
    </script>
</body>
</html>

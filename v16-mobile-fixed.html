<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="æ€ç»´ååŒå¤„ç†å™¨ - ç»“æ„åŒ–æ€è€ƒæ•´ç†ç³»ç»Ÿï¼Œå¸®åŠ©æ‚¨ç®¡ç†æ€ç»´æ¨¡å‹å’Œæ€è€ƒè®°å½•">
    <meta name="keywords" content="æ€ç»´æ¨¡å‹,æ€è€ƒæ•´ç†,çŸ¥è¯†ç®¡ç†,ç»“æ„åŒ–æ€è€ƒ,å“²å­¦,å…³ç³»æ¨¡å‹">
    <meta name="author" content="æ€ç»´ååŒå¤„ç†å™¨">
    <meta property="og:title" content="æ€ç»´ååŒå¤„ç†å™¨ - æ™ºèƒ½è§£æå¢å¼ºç‰ˆ">
    <meta property="og:description" content="ç»“æ„åŒ–æ€è€ƒæ•´ç†ç³»ç»Ÿï¼Œç®¡ç†æ‚¨çš„æ€ç»´æ¨¡å‹å’Œæ€è€ƒè®°å½•">
    <meta property="og:image" content="https://gift-aha.github.io/knowledge-base4/preview.png">
    <meta property="og:url" content="https://gift-aha.github.io/knowledge-base4">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* è¿™é‡Œä¿æŒåŸæœ‰çš„CSSæ ·å¼ï¼Œä¸ºäº†èŠ‚çœç©ºé—´ï¼Œæˆ‘ç§»é™¤äº†å¤§éƒ¨åˆ†æ ·å¼ä»£ç  */
        /* æ‚¨å¯ä»¥ä¿ç•™åŸæœ‰çš„æ‰€æœ‰CSSä»£ç  */
        
        /* åªæ·»åŠ ä¸€ä¸ªå…³é”®çš„æ–°æ ·å¼ */
        .mobile-import-notice {
            background: linear-gradient(to right, #4CAF50, #45a049);
            color: white;
            padding: 10px 15px;
            margin: 15px;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- ç§»åŠ¨ç«¯é¡¶éƒ¨æ  -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <div class="mobile-logo">
                <div class="mobile-logo-icon">ğŸ§ </div>
                <div class="mobile-logo-text" id="logo-text">æ€ç»´ååŒå¤„ç†å™¨</div>
            </div>
            <div class="mobile-header-actions">
                <button class="mobile-sync-btn" id="sync-btn" title="åŒæ­¥æ•°æ®">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="mobile-menu-btn" id="menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- åªè¯»æ¨¡å¼æç¤º -->
    <div class="read-only-banner">
        <i class="fas fa-lock"></i> ç§»åŠ¨ç«¯ä¸ºåªè¯»æŸ¥çœ‹æ¨¡å¼ï¼Œè¯·åœ¨ç”µè„‘ç«¯ç¼–è¾‘ä¿å­˜æ•°æ®
    </div>
    
    <!-- å¯¼å…¥æˆåŠŸæç¤º -->
    <div id="import-notice" class="mobile-import-notice" style="display: none;">
        <i class="fas fa-check-circle"></i> æ•°æ®å¯¼å…¥æˆåŠŸï¼Œå·²ä¿å­˜åˆ°ç§»åŠ¨ç«¯æœ¬åœ°å­˜å‚¨
    </div>
    
    <!-- ç§»åŠ¨ç«¯é€šçŸ¥åŒºåŸŸ -->
    <div class="mobile-notification" id="notification"></div>
    
    <!-- ç§»åŠ¨ç«¯é®ç½©å±‚ -->
    <div class="mobile-overlay" id="overlay"></div>
    
    <!-- ç§»åŠ¨ç«¯ä¾§è¾¹èœå• -->
    <div class="mobile-sidebar" id="sidebar">
        <!-- ä¾§è¾¹æ å†…å®¹ä¿æŒä¸å˜ -->
    </div>
    
    <!-- ç§»åŠ¨ç«¯ä¸»è¦å†…å®¹åŒº -->
    <div class="mobile-content" id="content">
        <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
        <div class="mobile-loading">
            <div class="mobile-loading-spinner"></div>
            <div>åŠ è½½ä¸­...</div>
        </div>
    </div>
    
    <!-- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆª -->
    <div class="mobile-bottom-nav">
        <!-- åº•éƒ¨å¯¼èˆªä¿æŒä¸å˜ -->
    </div>

    <!-- æ•°æ®ç®¡ç†æ¨¡æ€æ¡† -->
    <div class="mobile-modal" id="data-management-modal">
        <!-- æ¨¡æ€æ¡†å†…å®¹ä¿æŒä¸å˜ -->
    </div>

    <script>
        // ==================== ç§»åŠ¨ç«¯æ•°æ®ç®¡ç†å™¨ (ä¿®å¤ç‰ˆ) ====================
        // ä½¿ç”¨ç§»åŠ¨ç«¯ä¸“ç”¨å­˜å‚¨é”®ï¼Œé¿å…ä¸ç”µè„‘ç«¯å†²çª
        const MOBILE_STORAGE_KEY = 'structuredThoughtAssistant_MOBILE_BACKUP';
        
        // æ ‡è®°æ˜¯å¦ä¸ºå¯¼å…¥æ“ä½œ
        let isImportOperation = false;

        // æ›´æ™ºèƒ½çš„localStorageä¿æŠ¤
        const originalSetItem = localStorage.setItem;
        const originalGetItem = localStorage.getItem;
        const originalRemoveItem = localStorage.removeItem;
        
        localStorage.setItem = function(key, value) {
            // å¦‚æœæ˜¯ç§»åŠ¨ç«¯ä¸“ç”¨é”®ï¼Œå…è®¸ä¿å­˜
            if (key === MOBILE_STORAGE_KEY) {
                return originalSetItem.call(this, key, value);
            }
            
            // å¦‚æœæ˜¯ç”µè„‘ç«¯ä¸»é”®ï¼Œä½†æˆ‘ä»¬æ˜¯å¯¼å…¥æ“ä½œï¼Œå…è®¸ä¿å­˜
            if (key === 'structuredThoughtAssistant' && isImportOperation) {
                console.log('å…è®¸å¯¼å…¥æ“ä½œä¿å­˜æ•°æ®åˆ°ç§»åŠ¨ç«¯');
                // åŒæ—¶ä¿å­˜åˆ°ç§»åŠ¨ç«¯ä¸“ç”¨é”®
                originalSetItem.call(this, MOBILE_STORAGE_KEY, value);
                return originalSetItem.apply(this, arguments);
            }
            
            // å¦‚æœæ˜¯ç”µè„‘ç«¯ä¸»é”®ï¼Œä½†ä¸æ˜¯å¯¼å…¥æ“ä½œï¼Œé˜»æ­¢å¹¶æç¤º
            if (key === 'structuredThoughtAssistant') {
                console.warn('ç§»åŠ¨ç«¯ç¦æ­¢ä¿å­˜æ•°æ®ï¼Œè¯·åœ¨ç”µè„‘ç«¯ç¼–è¾‘');
                // æ˜¾ç¤ºå‹å¥½æç¤ºè€Œä¸æ˜¯alert
                const notice = document.getElementById('import-notice');
                if (notice) {
                    notice.innerHTML = '<i class="fas fa-lock"></i> ç§»åŠ¨ç«¯ä¸ºåªè¯»æ¨¡å¼ï¼Œè¯·åœ¨ç”µè„‘ç«¯ç¼–è¾‘';
                    notice.style.display = 'block';
                    notice.style.background = 'linear-gradient(to right, #f0ad4e, #ec971f)';
                    setTimeout(() => {
                        notice.style.display = 'none';
                    }, 3000);
                }
                return false;
            }
            
            // å…¶ä»–é”®æ­£å¸¸ä¿å­˜
            return originalSetItem.apply(this, arguments);
        };

        const MobileDataManager = {
            // ä½¿ç”¨ç§»åŠ¨ç«¯ä¸“ç”¨å­˜å‚¨é”®
            STORAGE_KEY: MOBILE_STORAGE_KEY,
            
            // æ•°æ®å­—æ®µ
            thoughts: [],
            models: [],
            tags: {},
            timeline: [],
            modelConnections: {},
            currentVersion: 'v22.48',
            lastSaved: null,
            
            // åˆå§‹åŒ–
            init: function() {
                this.loadFullData();
                return this;
            },
            
            // åŠ è½½å®Œæ•´æ•°æ®
            loadFullData: function() {
                try {
                    // å…ˆå°è¯•ä»ç§»åŠ¨ç«¯ä¸“ç”¨å­˜å‚¨åŠ è½½
                    let savedData = originalGetItem.call(localStorage, this.STORAGE_KEY);
                    
                    // å¦‚æœç§»åŠ¨ç«¯å­˜å‚¨æ²¡æœ‰æ•°æ®ï¼Œå°è¯•ä»ç”µè„‘ç«¯å­˜å‚¨åŠ è½½
                    if (!savedData) {
                        savedData = originalGetItem.call(localStorage, 'structuredThoughtAssistant');
                        if (savedData) {
                            console.log('ä»ç”µè„‘ç«¯å­˜å‚¨åŠ è½½æ•°æ®åˆ°ç§»åŠ¨ç«¯');
                            // å°†ç”µè„‘ç«¯æ•°æ®ä¿å­˜åˆ°ç§»åŠ¨ç«¯å­˜å‚¨
                            isImportOperation = true;
                            originalSetItem.call(localStorage, this.STORAGE_KEY, savedData);
                            isImportOperation = false;
                        }
                    }
                    
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        
                        // ç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼
                        this.thoughts = data.thoughts || [];
                        this.models = data.models || [];
                        this.tags = data.tags || {};
                        this.timeline = data.timeline || [];
                        this.modelConnections = data.modelConnections || {};
                        this.currentVersion = data.currentVersion || 'v22.48';
                        this.lastSaved = data.lastSaved || new Date().toISOString();
                        
                        console.log('ç§»åŠ¨ç«¯æ•°æ®åŠ è½½æˆåŠŸ:', {
                            thoughts: this.thoughts.length,
                            models: this.models.length,
                            tags: Object.keys(this.tags).length
                        });
                        
                        return true;
                    } else {
                        console.log('æœªæ‰¾åˆ°ä¿å­˜çš„æ•°æ®ï¼Œä½¿ç”¨ç©ºæ•°æ®');
                        // åˆå§‹åŒ–ç©ºæ•°æ®ç»“æ„
                        this.resetToEmpty();
                        return false;
                    }
                } catch (error) {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                    this.resetToEmpty();
                    return false;
                }
            },
            
            // é‡ç½®ä¸ºç©ºæ•°æ®
            resetToEmpty: function() {
                this.thoughts = [];
                this.models = [];
                this.tags = {};
                this.timeline = [];
                this.modelConnections = {};
                this.currentVersion = 'v22.48';
                this.lastSaved = new Date().toISOString();
            },
            
            // ä¿å­˜æ•°æ®åˆ°ç§»åŠ¨ç«¯å­˜å‚¨
            saveToMobileStorage: function() {
                try {
                    const data = {
                        thoughts: this.thoughts,
                        models: this.models,
                        tags: this.tags,
                        timeline: this.timeline,
                        modelConnections: this.modelConnections,
                        currentVersion: this.currentVersion,
                        lastSaved: new Date().toISOString(),
                        savedFrom: 'mobile',
                        savedAt: Date.now()
                    };
                    
                    originalSetItem.call(localStorage, this.STORAGE_KEY, JSON.stringify(data));
                    this.lastSaved = data.lastSaved;
                    console.log('æ•°æ®å·²ä¿å­˜åˆ°ç§»åŠ¨ç«¯å­˜å‚¨');
                    return true;
                } catch (error) {
                    console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                    return false;
                }
            },
            
            // è·å–æ€è€ƒè®°å½•
            getThoughtById: function(id) {
                return this.thoughts.find(t => t.id === id);
            },
            
            // è·å–æ€ç»´æ¨¡å‹
            getModelById: function(id) {
                return this.models.find(m => m.id === id);
            },
            
            // è·å–çƒ­é—¨æ ‡ç­¾
            getTopTags: function(limit = 12) {
                return Object.entries(this.tags)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, limit)
                    .map(([tag, count]) => ({ tag, count }));
            },
            
            // è·å–æœ€è¿‘æ€è€ƒè®°å½•
            getRecentThoughts: function(limit = 10) {
                return this.thoughts.slice(0, limit);
            },
            
            // è·å–æœ€è¿‘æ€ç»´æ¨¡å‹
            getRecentModels: function(limit = 10) {
                return this.models.slice(0, limit);
            },
            
            // æœç´¢åŠŸèƒ½
            search: function(query, type = 'all') {
                if (!query || query.trim() === '') {
                    return {
                        thoughts: [],
                        models: [],
                        tags: []
                    };
                }
                
                const searchTerm = query.toLowerCase().trim();
                const results = {
                    thoughts: [],
                    models: [],
                    tags: []
                };
                
                // æœç´¢æ€è€ƒè®°å½•
                if (type === 'all' || type === 'thoughts') {
                    results.thoughts = this.thoughts.filter(thought => {
                        return (
                            (thought.title && thought.title.toLowerCase().includes(searchTerm)) ||
                            (thought.id && thought.id.toLowerCase().includes(searchTerm)) ||
                            (thought.tags && thought.tags.some(tag => tag.toLowerCase().includes(searchTerm))) ||
                            (thought.sections && Object.values(thought.sections).some(section => 
                                section && section.toLowerCase().includes(searchTerm)
                            ))
                        );
                    });
                }
                
                // æœç´¢æ€ç»´æ¨¡å‹
                if (type === 'all' || type === 'models') {
                    results.models = this.models.filter(model => {
                        return (
                            (model.name && model.name.toLowerCase().includes(searchTerm)) ||
                            (model.id && model.id.toLowerCase().includes(searchTerm)) ||
                            (model.tags && model.tags.some(tag => tag.toLowerCase().includes(searchTerm))) ||
                            (model.description && model.description.toLowerCase().includes(searchTerm))
                        );
                    });
                }
                
                // æœç´¢æ ‡ç­¾
                if (type === 'all' || type === 'tags') {
                    results.tags = Object.keys(this.tags).filter(tag => 
                        tag.toLowerCase().includes(searchTerm)
                    ).map(tag => ({ tag, count: this.tags[tag] }));
                }
                
                return results;
            },
            
            // æŒ‰æ ‡ç­¾ç­›é€‰
            filterByTag: function(tag) {
                const thoughtsWithTag = this.thoughts.filter(thought => 
                    thought.tags && thought.tags.includes(tag)
                );
                
                const modelsWithTag = this.models.filter(model => 
                    model.tags && model.tags.includes(tag)
                );
                
                return {
                    thoughts: thoughtsWithTag,
                    models: modelsWithTag,
                    tag: tag
                };
            },
            
            // å¯¼å‡ºæ‰€æœ‰æ•°æ®
            exportAllData: function() {
                try {
                    const data = {
                        thoughts: this.thoughts,
                        models: this.models,
                        tags: this.tags,
                        timeline: this.timeline,
                        modelConnections: this.modelConnections,
                        currentVersion: this.currentVersion,
                        lastSaved: this.lastSaved,
                        exportDate: new Date().toISOString(),
                        exportFrom: 'ç§»åŠ¨ç«¯æŸ¥çœ‹ç‰ˆ'
                    };
                    
                    return JSON.stringify(data, null, 2);
                } catch (error) {
                    console.error('å¯¼å‡ºæ•°æ®å¤±è´¥:', error);
                    return null;
                }
            },
            
            // å¯¼å…¥æ•°æ® - å…³é”®ä¿®å¤éƒ¨åˆ†
            importData: function(jsonString) {
                try {
                    // è®¾ç½®å¯¼å…¥æ“ä½œæ ‡å¿—
                    isImportOperation = true;
                    
                    const imported = JSON.parse(jsonString);
                    
                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!imported.thoughts || !Array.isArray(imported.thoughts)) {
                        throw new Error('æ•°æ®æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘æ€è€ƒè®°å½•æ•°æ®');
                    }
                    
                    if (!imported.models || !Array.isArray(imported.models)) {
                        throw new Error('æ•°æ®æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘æ€ç»´æ¨¡å‹æ•°æ®');
                    }
                    
                    // å¯¼å…¥æ•°æ®åˆ°å†…å­˜
                    this.thoughts = imported.thoughts;
                    this.models = imported.models;
                    this.tags = imported.tags || {};
                    this.timeline = imported.timeline || [];
                    this.modelConnections = imported.modelConnections || {};
                    this.currentVersion = imported.currentVersion || 'v22.48';
                    this.lastSaved = new Date().toISOString();
                    
                    // ä¿å­˜åˆ°ç§»åŠ¨ç«¯å­˜å‚¨
                    const saveResult = this.saveToMobileStorage();
                    
                    // æ¸…é™¤å¯¼å…¥æ“ä½œæ ‡å¿—
                    isImportOperation = false;
                    
                    if (saveResult) {
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        const notice = document.getElementById('import-notice');
                        if (notice) {
                            notice.innerHTML = '<i class="fas fa-check-circle"></i> æ•°æ®å¯¼å…¥æˆåŠŸï¼Œå·²ä¿å­˜åˆ°ç§»åŠ¨ç«¯æœ¬åœ°å­˜å‚¨';
                            notice.style.display = 'block';
                            notice.style.background = 'linear-gradient(to right, #4CAF50, #45a049)';
                            setTimeout(() => {
                                notice.style.display = 'none';
                            }, 5000);
                        }
                        
                        return { 
                            success: true, 
                            message: 'æ•°æ®å¯¼å…¥æˆåŠŸ',
                            stats: {
                                thoughts: this.thoughts.length,
                                models: this.models.length,
                                tags: Object.keys(this.tags).length
                            }
                        };
                    } else {
                        throw new Error('æ— æ³•ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
                    }
                } catch (error) {
                    console.error('å¯¼å…¥æ•°æ®å¤±è´¥:', error);
                    isImportOperation = false;
                    return { 
                        success: false, 
                        error: error.message || 'å¯¼å…¥å¤±è´¥'
                    };
                }
            },
            
            // æ¸…é™¤æ•°æ®
            clearData: function() {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚\n\næ¸…é™¤åå¯ä»¥é‡æ–°å¯¼å…¥å¤‡ä»½æ•°æ®ã€‚')) {
                    try {
                        // æ¸…é™¤ç§»åŠ¨ç«¯å­˜å‚¨
                        originalRemoveItem.call(localStorage, this.STORAGE_KEY);
                        
                        // é‡ç½®å†…å­˜æ•°æ®
                        this.resetToEmpty();
                        
                        return true;
                    } catch (error) {
                        console.error('æ¸…é™¤æ•°æ®å¤±è´¥:', error);
                        return false;
                    }
                }
                return false;
            },
            
            // åŒæ­¥æ•°æ®ï¼ˆé‡æ–°åŠ è½½ï¼‰
            syncData: function() {
                return this.loadFullData();
            }
        };
        
        // ==================== ç§»åŠ¨ç«¯UIç®¡ç†å™¨ (ç®€åŒ–ç‰ˆ) ====================
        const MobileUI = {
            currentView: 'overview',
            currentDetailId: null,
            currentDetailType: null,
            searchQuery: '',
            currentPage: 1,
            itemsPerPage: 10,
            dataManager: null,
            
            // åˆå§‹åŒ–
            init: function() {
                // åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
                this.dataManager = MobileDataManager.init();
                
                // è®¾ç½®UIäº‹ä»¶
                this.setupEvents();
                
                // æ¸²æŸ“åˆå§‹è§†å›¾
                this.renderView('overview');
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                this.updateStats();
                
                console.log('ç§»åŠ¨ç«¯UIåˆå§‹åŒ–å®Œæˆ');
            },
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEvents: function() {
                // èœå•æŒ‰é’®
                document.getElementById('menu-btn').addEventListener('click', () => this.openSidebar());
                
                // åŒæ­¥æŒ‰é’®
                document.getElementById('sync-btn').addEventListener('click', () => {
                    this.showNotification('åŒæ­¥ä¸­...', 'info');
                    setTimeout(() => {
                        this.dataManager.syncData();
                        this.updateStats();
                        this.renderView(this.currentView);
                        this.showNotification('åŒæ­¥å®Œæˆ', 'success');
                    }, 500);
                });
                
                // å…¶ä»–äº‹ä»¶ç›‘å¬å™¨...
            },
            
            // æ¸²æŸ“æ¦‚è§ˆé¡µé¢
            renderOverview: function() {
                const recentThoughts = this.dataManager.getRecentThoughts(5);
                const recentModels = this.dataManager.getRecentModels(5);
                const topTags = this.dataManager.getTopTags(8);
                
                let html = `
                    <div class="mobile-stats">
                        <div class="mobile-stat-card">
                            <div class="mobile-stat-value">${this.dataManager.thoughts.length}</div>
                            <div class="mobile-stat-label">æ€è€ƒè®°å½•</div>
                        </div>
                        <div class="mobile-stat-card">
                            <div class="mobile-stat-value">${this.dataManager.models.length}</div>
                            <div class="mobile-stat-label">æ€ç»´æ¨¡å‹</div>
                        </div>
                        <div class="mobile-stat-card">
                            <div class="mobile-stat-value">${Object.keys(this.dataManager.tags).length}</div>
                            <div class="mobile-stat-label">æ ‡ç­¾åˆ†ç±»</div>
                        </div>
                        <div class="mobile-stat-card">
                            <div class="mobile-stat-value">${this.dataManager.currentVersion}</div>
                            <div class="mobile-stat-label">ç³»ç»Ÿç‰ˆæœ¬</div>
                        </div>
                    </div>
                `;
                
                // æ˜¾ç¤ºæ€è€ƒè®°å½•
                html += `
                    <div class="mobile-card">
                        <div class="mobile-card-title">
                            <i class="fas fa-file-alt" style="margin-right: 8px;"></i>
                            æœ€è¿‘æ€è€ƒè®°å½•
                        </div>
                        <div class="mobile-card-content">
                `;
                
                if (recentThoughts.length > 0) {
                    recentThoughts.forEach(thought => {
                        html += `
                            <div class="mobile-list-item" onclick="MobileUI.showThoughtDetail('${thought.id}')" 
                                 style="padding: 12px 0; border-bottom: 1px solid var(--border-color); cursor: pointer;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 500; font-size: 14px; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                        ${thought.title || thought.id}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<div style="text-align: center; color: var(--text-light); padding: 20px;">æš‚æ— æ€è€ƒè®°å½•</div>';
                }
                
                html += `</div></div>`;
                
                // æ˜¾ç¤ºæ€ç»´æ¨¡å‹
                html += `
                    <div class="mobile-card">
                        <div class="mobile-card-title">
                            <i class="fas fa-cube" style="margin-right: 8px;"></i>
                            æœ€è¿‘æ€ç»´æ¨¡å‹
                        </div>
                        <div class="mobile-card-content">
                `;
                
                if (recentModels.length > 0) {
                    recentModels.forEach(model => {
                        html += `
                            <div class="mobile-list-item" onclick="MobileUI.showModelDetail('${model.id}')" 
                                 style="padding: 12px 0; border-bottom: 1px solid var(--border-color); cursor: pointer;">
                                <div style="font-weight: 500; font-size: 14px;">
                                    ${model.id}: ${model.name}
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<div style="text-align: center; color: var(--text-light); padding: 20px;">æš‚æ— æ€ç»´æ¨¡å‹</div>';
                }
                
                html += `</div></div>`;
                
                return html;
            },
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification: function(message, type = 'info') {
                const notification = document.getElementById('notification');
                if (!notification) return;
                
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;
                
                notification.className = `mobile-notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            },
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStats: function() {
                const thoughtCount = document.getElementById('sidebar-thought-count');
                const modelCount = document.getElementById('sidebar-model-count');
                const tagCount = document.getElementById('sidebar-tag-count');
                
                if (thoughtCount) thoughtCount.textContent = this.dataManager.thoughts.length;
                if (modelCount) modelCount.textContent = this.dataManager.models.length;
                if (tagCount) tagCount.textContent = Object.keys(this.dataManager.tags).length;
            },
            
            // å¯¼å‡ºæ‰€æœ‰æ•°æ®
            exportAllData: function() {
                const data = this.dataManager.exportAllData();
                if (!data) {
                    this.showNotification('å¯¼å‡ºå¤±è´¥', 'error');
                    return;
                }
                
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `æ€ç»´ååŒå¤„ç†å™¨_ç§»åŠ¨ç«¯å¤‡ä»½_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
            },
            
            // å¯¼å…¥æ•°æ®
            importData: function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const result = this.dataManager.importData(event.target.result);
                        if (result.success) {
                            this.updateStats();
                            this.renderView(this.currentView);
                            this.showNotification(`å¯¼å…¥æˆåŠŸ: ${result.stats.thoughts}æ¡æ€è€ƒ, ${result.stats.models}ä¸ªæ¨¡å‹`, 'success');
                        } else {
                            this.showNotification(`å¯¼å…¥å¤±è´¥: ${result.error}`, 'error');
                        }
                    };
                    reader.readAsText(file);
                };
                
                input.click();
            },
            
            // æ¸…é™¤æ•°æ®
            clearData: function() {
                if (this.dataManager.clearData()) {
                    this.updateStats();
                    this.renderView('overview');
                    this.showNotification('æ•°æ®å·²æ¸…é™¤', 'success');
                }
            },
            
            // æ‰“å¼€ä¾§è¾¹æ 
            openSidebar: function() {
                document.getElementById('sidebar').classList.add('active');
                document.getElementById('overlay').classList.add('active');
            },
            
            // æ¸²æŸ“è§†å›¾
            renderView: function(view) {
                const content = document.getElementById('content');
                if (!content) return;
                
                let html = '';
                switch(view) {
                    case 'overview':
                        html = this.renderOverview();
                        break;
                    default:
                        html = this.renderOverview();
                }
                
                content.innerHTML = html;
            }
        };
        
        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥æ˜¯å¦æœ‰å·²ä¿å­˜çš„æ•°æ®
            const hasMobileData = localStorage.getItem(MOBILE_STORAGE_KEY);
            const hasDesktopData = localStorage.getItem('structuredThoughtAssistant');
            
            if (!hasMobileData && hasDesktopData) {
                // å¦‚æœæœ‰ç”µè„‘ç«¯æ•°æ®ä½†æ²¡æœ‰ç§»åŠ¨ç«¯æ•°æ®ï¼Œæç¤ºç”¨æˆ·
                console.log('æ£€æµ‹åˆ°ç”µè„‘ç«¯æ•°æ®ï¼Œå¯ä»¥å¯¼å…¥åˆ°ç§»åŠ¨ç«¯');
            }
            
            // åˆå§‹åŒ–ç§»åŠ¨ç«¯UI
            MobileUI.init();
        });
    </script>
</body>
</html>
